# https://circleci.com/docs/configuration#machine
machine:
  php:
    # https://circleci.com/docs/environment#php
    version: 5.5.11
  environment:
    # DB config. Using default CircleCI's database.
    DB_NAME: "circle_test"
    DB_USERNAME: "ubuntu"
    DB_PASSWORD: ""
    DOCROOT: "$HOME/$CIRCLE_PROJECT_REPONAME/"

dependencies:
  cache_directories:
    - ~/.composer/cache
  post:
    - cd private/behat-testing/ && composer install
    - composer global require drush/drush:8.*
test:
  pre:
    - php -d sendmail_path=$(which true) &&  drush --yes --root=$DOCROOT site-install config_installer --db-url=mysql://$DB_USERNAME:$DB_PASSWORD@127.0.0.1/$DB_NAME install_configure_form.update_status_module='array(FALSE,FALSE)'
    - drush config-list
  override:
    # Run phpcs
    # @todo, figure out why running these from phpcs.sh no longer causes
    # circle fails.
    # Circle did fail here: https://circleci.com/gh/stevector/nerdologues-d8/4
    # But not here: https://circleci.com/gh/stevector/nerdologues-d8/18
    - cd private/behat-testing/  && ./bin/phpcs --report=full --extensions=php,module,inc,theme,info --standard=vendor/drupal/coder/coder_sniffer/Drupal/  ../../modules/custom
    - cd private/behat-testing/  && ./bin/phpcs --report=full --extensions=php,module,inc,theme,info --standard=vendor/drupal/coder/coder_sniffer/Drupal/  ../../themes/custom
